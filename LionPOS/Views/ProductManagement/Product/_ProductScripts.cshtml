@model LionPOSServiceContractModels.ControllerContractModel.ProductManagement.ProductCCM

<script>
    var SQLDataTypeJosn = @Html.Raw(Model.SQLDataTypeJosn);
</script>
<script>
    var FilterList = new Array();
    var FilterObject =new Object();
    FilterObject.name= "@Model.Pagination.FilterActionName";
    FilterObject.FilterFieldModelJson = function(){ return @Html.Raw(Model.FilterFieldModelJson)};
    FilterObject.FilterURLLink = "@Url.Action(Model.Pagination.FilterActionName, Model.Pagination.controllerName, null,Request.Url.Scheme)";
    FilterObject.FilterFetchedFired = false;
    FilterObject.whereClauseStream = "" ;
    FilterObject.OrderByStream = "" ;
    FilterObject.SaveAsDefaultFilter = false;
    FilterObject.LoadAsDefaultFilter = true;
    FilterList.push(FilterObject);

    var InfinityList = new Array();
    var InfinityObject =new Object();
    InfinityObject.name= "@Model.Pagination.FilterActionName";
    InfinityObject.scrollBarContainer = window;
    InfinityObject.areaHeight = $(window);
    InfinityObject.documentHeight = $("body");
    InfinityObject.InfinitePageFetchURLink = "@Url.Action(Model.Pagination.FilterActionName,Model.Pagination.controllerName, null,Request.Url.Scheme)";
    InfinityObject.TotalPage = @Model.Pagination.TotalPages;
    InfinityObject.InfiniteDataFetchedFired = false;
    InfinityObject.InfiniteDataFetchedNextPageNumber = 2;
    InfinityList.push(InfinityObject);
</script>





@*++++++++++++++Script to load Start+++++++++++++++++++*@
<script src="~/Scripts/ScriptCustom/FilterControlPlugin.js"></script>
<script src="~/Scripts/ScriptCustom/InfiniteScrollPagerPlugin.js"></script>
<!-- Loaded from F:\Client\POS Master\Jay B\Source Code Master\LionPOS 09-04-2016\LionPOS 08-04-2016\LionPOS\LionPOS\Content\assets\globals\js\global-vendors.js -->
@*<script src="~/Scripts/bootstrap.js"></script>*@
@* JQueryValidation JS*@
<script src="~/Scripts/jquery.validate.min.js"></script>
@* Tool Tip JS*@
<script src="~/Scripts/jquery-validate.bootstrap-tooltip.min.js"></script>
@* Editor JS*@
<script src="~/Scripts/tinymce/tinymce.min.js"></script>
@*++++++++++++++Script to load End+++++++++++++++++++*@
<!-- check box select all code +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<script>
    function initTinyMCE(){
        tinymce.init({
            selector: ".TinyMCE",
            plugins: [
                "advlist autolink lists link image charmap print preview anchor",
                "searchreplace visualblocks  fullscreen",
                "insertdatetime media table contextmenu paste textcolor "
            ],
            toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | forecolor backcolor"
        });
    }
    var checkBoxFlag = true;
    $(document).on("click", ".checkboxer", function (e) {
        if (checkBoxFlag == true) {
            checkBoxFlag = false;
            if ($($(this).find("input")[0]).attr("id") == "chkSelectAllData") {
                $(this).find("input")[0].click();
                var checked = $("input[id=chkSelectAllData]:checked").length;
                $.each($(".selectAllCheckBoxClass").find("input"), function (index, val) {
                    if (checked == 1 && $("input[id=" + $(val).attr("id") + "]:checked").length <= 0) {
                        $(val).click();
                    }
                    else if (checked == 0 && $("input[id=" + $(val).attr("id") + "]:checked").length > 0) {
                        $(val).click();
                    }
                });

                checkBoxFlag = true;
            }
            else {
                $(this).find("input")[0].click();
                if ($(".selectAllCheckBoxClass").find("input").length == $(".selectAllCheckBoxClass").find("input[type=checkbox]:checked").length) {
                    if ($("input[id=chkSelectAllData]:checked").length <= 0) {
                        $("#chkSelectAllData").click();
                    }
                }
                else {
                    if ($("input[id=chkSelectAllData]:checked").length > 0) {
                        $("#chkSelectAllData").click();
                    }
                }
                checkBoxFlag = true;
            }
        }
    });

    $(document).on("click","#btnsubmit",function(){
        $("#ldrFormCreateAction").show();
        $.ajax({
            success: function (data) {
                $("#ldrFormCreateAction").hide();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                $("#ldrFormCreateAction").hide();
            }
        });
    });


    $(document).on("click","#btnAddNew",function(){
        if($("#addNewLoaderPlaceholder").css("display") == "none" && $("#card-body-1").length <= 0)
        {
            $("#addNewLoaderPlaceholder").show();
            $.ajax({
                url: "@Url.Action(Model.InsertActionName, Model.Pagination.controllerName,null,Request.Url.Scheme)",
                data: {},
                type: "POST",
                cache: false,
                async: true,
                success: function (data) {
                    if( data.errorLogId > 0)
                    {
                        window.location = data.errorURL;
                    }else
                    {
                        $("#filter@(Model.Pagination.FilterActionName)Container").prepend(data.view);
                    }
                    $("#addNewLoaderPlaceholder").hide();
                    tinymce.remove();
                    initTinyMCE();
                    activateFormValidations();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $("#addNewLoaderPlaceholder").hide();
                    //$("#filter" + filter.name + "Container").html("");
                    //filter.FilterFetchedFired = false;
                    //alert(thrownError.toString());
                }
            });
        }
    });
    $(document).on("click","#btndelete",function(){
        var sku=$("#btndelete").data("sku");
        var bodyid = $("#btndelete").data("bodyid");
        $("#btnConfirm").data("sku",sku);
        $("#btnConfirm").data("bodyid",bodyid);
    });
    $(document).on("click","#btnConfirm",function(){
        var sku=$(this).data("sku");
        var bodyid = $(this).data("bodyid");

        var  del=  $("#card-body" + sku).find("#btndelete");
        var loader = $(del).data("confirm-loader");
        var delurl = $(del).data("delete-url");
        var delkeys = $(del).data("delete-keys");
        if(loader != null && loader != undefined && loader != "")
        {
            $("#" + loader ).show();
        }



        $.ajax({
            url: delurl,
            data: { deletekeys:delkeys },
            type: "POST",
            cache: false,
            async: true,
            success: function (data) {
                if( data.errorLogId > 0)
                {
                    window.location = data.errorURL;
                }

                $("#" + bodyid).parent().parent().remove();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                $("#" + loader ).hide();
                alert(thrownError);
            }
        });
    });


    $(document).on("click","#btnShowDetails",function(){

        var bodyid= $(this).data("bodyid");
        $("#" + bodyid).css("display","block");
        $("#" + bodyid).html(
        '<div style="height:180px;margin:10px;">'+
                   '<div id="loader"></div>'+
               '</div>'
        );
        var sku=$(this).data("sku");
        $.ajax({
            url: "@Url.Action("GetProductDetails", Model.Pagination.controllerName,null,Request.Url.Scheme)",
            data: { sku:sku },
            type: "POST",
            cache: false,
            async: true,
            success: function (data) {
                if( data.errorLogId > 0)
                {
                    window.location = data.errorURL;
                }
                $("#" + bodyid).replaceWith(data.view);
                tinymce.remove();
                initTinyMCE();
                activateFormValidations();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                $("#" + loaderid).html("");
                alert(thrownError);
            }
        });
    });





    $(document).on("click", '#btnMultiSubmit', function (e) {
        $("#bulkActionSubmitLoader").show();

        var str ="";
        $.each($('.chkSelect:checked'),function (index,val) {
            if(str != "")
            {
                str = str + ",";
            }
            str = str + $(val).attr("id");
        });
        var action = $("#BulkAction").val();
        $.ajax({
            url: '@Url.Action(Model.bulkActionName, Model.Pagination.controllerName,null,Request.Url.Scheme)',
            data: { skus: str, action: action },
            type: "POST",
            cache: false,
            async: true,
            success: function (data) {
                location.reload();
                $("#bulkActionSubmitLoader").hide();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                $("#bulkActionSubmitLoader").hide();
            }
        });
    });


    function OnCompleteUpdate(data) {
        if (data.errorLogid > 0) {
            window.location = data.errorUrl;
        }
        else {

            $(this).parent().parent().parent().parent().parent().parent().prepend(data.responseJSON.view);
            $(this).parent().parent().parent().parent().parent().remove();
        }
    }
    function OnFailureUpdate(ex) {
        $(this).parent().parent().parent().parent().parent().html("");
        alert("Some Error occured : " + ex);
    }
    function Confirm() {
        window.alert("Are you Sure???");
    }



    $(function () {
        $("#sortable").sortable();
        $("#sortable").disableSelection();
    });

    $(document).on("click",".btn",function(){
        SetPreSubmitState($(this));
    });

    function SetPreSubmitState(ths)
    {
        var loader = $(ths).data("loader");
        if(loader != null && loader != undefined && loader != "")
        {
            $("#" + loader ).show();
        }
        loader = $(ths).data("remove-element-id");

        if(loader != null && loader != undefined && loader != "")
        {
            $("#" + loader ).remove();
        }
        loader = $(ths).data("remove-innerhtml-element-id");
        if(loader != null && loader != undefined && loader != "")
        {
            $("#" + loader ).html("");
        }
    }



    var ProductformID = "#Productform"
    function activateFormValidations()
    {
        $(ProductformID).validate({
            rules: {
                "productDCM.sku": {
                    required: true,
                    maxlength: 45
                },
                "productDCM.title": {
                    required: true,
                },
                "productDCM.unit_of_mesurement_title": {
                    required: true,
                    maxlength: 45
                },
                "productDCM.discount": {
                    required: true,
                    maxlength: 10
                },
                "productDCM.discountInPercentage": {
                    required: true,
                }
            },
            messages: {
                "productDCM.sku":
                    {
                        required: "Please enter Sku.",
                        maxlength: "You can enter maximum 45 character."
                    },
                "productDCM.title":
                   {
                       required: "Please enter Title.",
                   },
                "productDCM.unit_of_mesurement_title": {
                    required: "Please enter Unit of Mesurement Title.",
                    maxlength: "You can enter maximum 45 character."
                },
                "productDCM.discount": {
                    required: "Only 10 Digit Allowed"
                },

                "productDCM.discountInPercentage": {
                    required:"Please enter Discount In Percentage.",
                }
            },
            invalidHandler: function(event, validator) {
                $.each($(ProductformID).find(".btn"),function(index,val){
                    var loader = $(val).data("loader");
                    $("#" + loader ).hide();
                });
            }

        });
    }

    function OnProductFormAjaxComplete(data) {
        if (data.responseJSON.errorLogid > 0) {
            window.location = data.responseJSON.errorUrl;
        }
        else {
            $(this).parent().parent().parent().css("display","none");
            if(data.responseJSON.crudOprationType == "@Html.Raw(LionPOSServiceContractModels.ConstantDictionaryContractModel.ConstantDictionaryCM.crudOprationTypes.Insert)")
            {
                $(this).parent().parent().parent().parent().parent().parent().prepend(data.responseJSON.view);
                $(this).parent().parent().parent().parent().parent().remove();
            }
            if(data.responseJSON.crudOprationType == "@Html.Raw(LionPOSServiceContractModels.ConstantDictionaryContractModel.ConstantDictionaryCM.crudOprationTypes.Update)")
            {
                $(this).parent().parent().parent().parent().parent().replaceWith(data.responseJSON.view);
            }

            location.href = $(this).closest(".card ").find(".card-title a").attr("href");
        }
    }
    function OnProductFormAjaxFailure(ex) {
        alert("Some Error occured : " + ex);
    }
     $(document).on('change', '#isActive', function () {

                        if (checkBoxFlag == true) {
                            checkBoxFlag = false;
                            var checked = $("input[id=isActive]:checked").length;
                            if (checked == 1)
                            {$('#Acthidden').val(true);}
                            else
                            { $('#Acthidden').val(false);  }
                        }
                        else {
                            checkBoxFlag = true;
                            var checked = $("input[id=isActive]:checked").length;
                            if (checked == 1)
                           {$('#Acthidden').val(true);}
                            else
                            { $('#Acthidden').val(false);  }
                        }
                    });

</script>
